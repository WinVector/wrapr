<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>bquote • wrapr</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js" integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha256-916EbMg70RQy9LHiGkXzG8hSg9EdNy97GazNG/aiY1w=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha256-U5ZEeKfGNOja007MMD3YBI0A3OSZOQbeG6z2f2Y0hu8=" crossorigin="anonymous"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.7.1/css/all.min.css" integrity="sha256-nAmazAk6vS34Xqo0BSrTb+abbtFlgsFK7NKSi6o7Y78=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.7.1/css/v4-shims.min.css" integrity="sha256-6qHlizsOWFskGlwVOKuns+D1nB6ssZrHQrNj1wGplHc=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.4/clipboard.min.js" integrity="sha256-FiZwavyI2V6+EXO1U+xzLG3IKldpiTFf3153ea9zikQ=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.9.4/headroom.min.js" integrity="sha256-DJFC1kqIhelURkuza0AvYal5RxMtpzLjFhsnVIeuk+U=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.9.4/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="bquote">
<meta property="og:description" content="">
<meta name="twitter:card" content="summary">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">wrapr</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">2.0.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/CornerCases.html">Corner Cases</a>
    </li>
    <li>
      <a href="../articles/DebugFnW.html">Debug Vignette</a>
    </li>
    <li>
      <a href="../articles/FrameTools.html">Frame Tools</a>
    </li>
    <li>
      <a href="../articles/Named_Arguments.html">Named Arguments</a>
    </li>
    <li>
      <a href="../articles/QuotingConcatinate.html">Quoting Concatinate</a>
    </li>
    <li>
      <a href="../articles/SubstitutionModes.html">Substitution Modes</a>
    </li>
    <li>
      <a href="../articles/bquote.html">bquote</a>
    </li>
    <li>
      <a href="../articles/dot_pipe.html">Dot Pipe</a>
    </li>
    <li>
      <a href="../articles/lambda.html">lambda Function Builder</a>
    </li>
    <li>
      <a href="../articles/let.html">Let</a>
    </li>
    <li>
      <a href="../articles/multi_assign.html">Multiple Assignment</a>
    </li>
    <li>
      <a href="../articles/named_map_builder.html">Named Map Builder</a>
    </li>
    <li>
      <a href="../articles/unpack_multiple_assignment.html">Multiple Assignment with unpack</a>
    </li>
    <li>
      <a href="../articles/wrapr_Eager.html">wrapr Eager Evaluation</a>
    </li>
    <li>
      <a href="../articles/wrapr_applicable.html">wrapr_applicable</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="http://www.win-vector.com/">Sponsor: Win-Vector LLC</a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1>bquote</h1>
                        <h4 class="author">John Mount</h4>
            
            <h4 class="date">2020-03-17</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/WinVector/wrapr/blob/master/vignettes/bquote.Rmd"><code>vignettes/bquote.Rmd</code></a></small>
      <div class="hidden name"><code>bquote.Rmd</code></div>

    </div>

    
    
<p>It would be nice if <a href="https://www.r-project.org"><code>R</code></a> <a href="https://en.wikipedia.org/wiki/String_interpolation">string-interpolation</a> and <a href="https://en.wikipedia.org/wiki/Grave_accent#Use_in_programming">quasi-quotation</a> both used the same notation. They are related concepts. So some commonality of notation would actually be clarifying, and help teach the concepts. We will define both of the above terms, and demonstrate the relation between the two concepts.</p>
<div id="string-interpolation" class="section level2">
<h2 class="hasAnchor">
<a href="#string-interpolation" class="anchor"></a>String-interpolation</h2>
<p><a href="https://en.wikipedia.org/wiki/String_interpolation">String-interpolation</a> is the name for substituting value into a string. For example:</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1-1" data-line-number="1"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="st">"wrapr"</span>)</a>
<a class="sourceLine" id="cb1-2" data-line-number="2"></a>
<a class="sourceLine" id="cb1-3" data-line-number="3">variable &lt;-<span class="st"> "angle"</span></a>
<a class="sourceLine" id="cb1-4" data-line-number="4"></a>
<a class="sourceLine" id="cb1-5" data-line-number="5"><span class="kw"><a href="../reference/sinterp.html">sinterp</a></span>(</a>
<a class="sourceLine" id="cb1-6" data-line-number="6">  <span class="st">'variable name is .(variable)'</span></a>
<a class="sourceLine" id="cb1-7" data-line-number="7">)</a></code></pre></div>
<pre><code>## [1] "variable name is \"angle\""</code></pre>
<p>Notice the “<code>.(variable)</code>” portion was replaced with the actual variable name “<code>angle</code>”. For string interpolation we are intentionally using the “<code>.()</code>” notation that Thomas Lumley’s picked in 2003 when he introduced quasi-quotation into <code>R</code> (a different concept than string-interpolation, but the topic of our next section).</p>
<p>String interpolation is a common need, and there are many <a href="https://www.r-project.org"><code>R</code></a> packages that supply variations of such functionality:</p>
<ul>
<li><code><a href="https://rdrr.io/r/base/sprintf.html">base::sprintf</a></code></li>
<li><a href="https://CRAN.R-project.org/package=R.utils"><code><a href="https://rdrr.io/pkg/R.utils/man/gstring.html">R.utils::gstring()</a></code></a></li>
<li><a href="https://CRAN.R-project.org/package=rprintf"><code>rprintf::rprintf()</code></a></li>
<li><a href="https://CRAN.R-project.org/package=stringr"><code><a href="https://stringr.tidyverse.org/reference/str_interp.html">stringr::str_interp()</a></code></a></li>
<li><a href="https://CRAN.R-project.org/package=glue"><code><a href="https://rdrr.io/pkg/glue/man/glue.html">glue::glue()</a></code></a></li>
<li>
<a href="https://winvector.github.io/wrapr/reference/sinterp.html"><code><a href="../reference/sinterp.html">wrapr::sinterp()</a></code></a>.</li>
</ul>
</div>
<div id="quasi-quotation" class="section level2">
<h2 class="hasAnchor">
<a href="#quasi-quotation" class="anchor"></a>Quasi-quotation</h2>
<p>A related idea is <a href="https://en.wikipedia.org/wiki/Grave_accent#Use_in_programming">“quasi-quotation”</a> which substitutes a value into a general expression. For example:</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb3-1" data-line-number="1">angle =<span class="st"> </span><span class="dv">1</span><span class="op">:</span><span class="dv">10</span></a>
<a class="sourceLine" id="cb3-2" data-line-number="2">variable_name &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/name.html">as.name</a></span>(<span class="st">"angle"</span>)</a>
<a class="sourceLine" id="cb3-3" data-line-number="3"></a>
<a class="sourceLine" id="cb3-4" data-line-number="4"><span class="cf">if</span>(<span class="kw"><a href="https://rdrr.io/r/base/ns-load.html">requireNamespace</a></span>(<span class="st">"graphics"</span>, <span class="dt">quietly =</span> <span class="ot">TRUE</span>)) {</a>
<a class="sourceLine" id="cb3-5" data-line-number="5">  <span class="kw"><a href="../reference/evalb.html">evalb</a></span>(</a>
<a class="sourceLine" id="cb3-6" data-line-number="6">    </a>
<a class="sourceLine" id="cb3-7" data-line-number="7">    <span class="kw"><a href="https://rdrr.io/r/graphics/plot.html">plot</a></span>(<span class="dt">x =</span> .(<span class="op">-</span>variable_name), </a>
<a class="sourceLine" id="cb3-8" data-line-number="8">         <span class="dt">y =</span> <span class="kw"><a href="https://rdrr.io/r/base/Trig.html">sin</a></span>(.(<span class="op">-</span>variable_name)))</a>
<a class="sourceLine" id="cb3-9" data-line-number="9">    </a>
<a class="sourceLine" id="cb3-10" data-line-number="10">  )</a>
<a class="sourceLine" id="cb3-11" data-line-number="11">}</a></code></pre></div>
<p><img src="bquote_files/figure-html/unnamed-chunk-2-1.png" width="700"></p>
<p>Notice how in the above plot the actual variable name “<code>angle</code>” was substituted into the <code><a href="https://rdrr.io/r/graphics/plot.html">graphics::plot()</a></code> arguments, allowing this name to appear on the axis labels.</p>
<p>We can also use strings in place of names by using the <code>.(-)</code> “strip quotes to convert strings to name notation.”</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb4-1" data-line-number="1">angle =<span class="st"> </span><span class="dv">1</span><span class="op">:</span><span class="dv">10</span></a>
<a class="sourceLine" id="cb4-2" data-line-number="2">variable_string &lt;-<span class="st"> "angle"</span></a>
<a class="sourceLine" id="cb4-3" data-line-number="3"></a>
<a class="sourceLine" id="cb4-4" data-line-number="4"><span class="cf">if</span>(<span class="kw"><a href="https://rdrr.io/r/base/ns-load.html">requireNamespace</a></span>(<span class="st">"graphics"</span>, <span class="dt">quietly =</span> <span class="ot">TRUE</span>)) {</a>
<a class="sourceLine" id="cb4-5" data-line-number="5">  <span class="kw"><a href="../reference/evalb.html">evalb</a></span>(</a>
<a class="sourceLine" id="cb4-6" data-line-number="6">    </a>
<a class="sourceLine" id="cb4-7" data-line-number="7">    <span class="kw"><a href="https://rdrr.io/r/graphics/plot.html">plot</a></span>(<span class="dt">x =</span> .(<span class="op">-</span>variable_string), </a>
<a class="sourceLine" id="cb4-8" data-line-number="8">         <span class="dt">y =</span> <span class="kw"><a href="https://rdrr.io/r/base/Trig.html">sin</a></span>(.(<span class="op">-</span>variable_string)))</a>
<a class="sourceLine" id="cb4-9" data-line-number="9">    </a>
<a class="sourceLine" id="cb4-10" data-line-number="10">  )</a>
<a class="sourceLine" id="cb4-11" data-line-number="11">}</a></code></pre></div>
<p><img src="bquote_files/figure-html/unnamed-chunk-3-1.png" width="700"></p>
<p><code><a href="../reference/evalb.html">evalb()</a></code> is a very simple function built on top of <code><a href="https://rdrr.io/r/base/bquote.html">base::bquote()</a></code>.</p>
<p>All <code><a href="../reference/evalb.html">evalb()</a></code> does is: call <code><a href="https://rdrr.io/r/base/bquote.html">bquote()</a></code> as intended, with the extension that <code>.(-x)</code> is shorthand for <code>.(as.name(x))</code>.</p>
<p>And we see the un-executed code with the substitutions performed.</p>
<p>There are many <code>R</code> quasi-quotation systems including:</p>
<ul>
<li><code><a href="https://rdrr.io/r/base/bquote.html">base::bquote()</a></code></li>
<li><a href="https://CRAN.R-project.org/package=gtools"><code><a href="https://rdrr.io/pkg/gtools/man/defmacro.html">gtools::strmacro()</a></code></a></li>
<li><a href="https://CRAN.R-project.org/package=lazyeval"><code>lazyeval</code></a></li>
<li><a href="https://winvector.github.io/wrapr/reference/let.html"><code><a href="../reference/let.html">wrapr::let()</a></code></a></li>
<li><a href="https://rlang.r-lib.org/reference/as_quosure.html"><code><a href="https://rlang.r-lib.org/reference/as_quosure.html">rlang::as_quosure()</a></code></a></li>
<li><a href="https://CRAN.R-project.org/package=nseval"><code>nseval</code></a></li>
</ul>
<p>If you don’t want to wrap your <code><a href="https://rdrr.io/r/graphics/plot.html">plot()</a></code> call in <code><a href="../reference/evalb.html">evalb()</a></code> you can instead pre-adapt the function. Below we create a new function <code>plotb()</code> that is intended as shorthand for <code>eval(bquote(plot(…)))</code>.</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb5-1" data-line-number="1">plotb &lt;-<span class="st"> </span><span class="kw"><a href="../reference/bquote_function.html">bquote_function</a></span>(graphics<span class="op">::</span>plot)</a>
<a class="sourceLine" id="cb5-2" data-line-number="2"></a>
<a class="sourceLine" id="cb5-3" data-line-number="3"><span class="cf">if</span>(<span class="kw"><a href="https://rdrr.io/r/base/ns-load.html">requireNamespace</a></span>(<span class="st">"graphics"</span>, <span class="dt">quietly =</span> <span class="ot">TRUE</span>)) {</a>
<a class="sourceLine" id="cb5-4" data-line-number="4">  <span class="kw">plotb</span>(<span class="dt">x =</span> .(<span class="op">-</span>variable), </a>
<a class="sourceLine" id="cb5-5" data-line-number="5">        <span class="dt">y =</span> <span class="kw"><a href="https://rdrr.io/r/base/Trig.html">sin</a></span>(.(<span class="op">-</span>variable)))</a>
<a class="sourceLine" id="cb5-6" data-line-number="6">}</a></code></pre></div>
<p><img src="bquote_files/figure-html/unnamed-chunk-4-1.png" width="700"></p>
<p>The <code>wrapr</code> <a href="https://winvector.github.io/wrapr/reference/dot_arrow.html">dot arrow pipe</a> also uses the <code>bquote</code>-style escape to specify “extra execution”. For example.</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb6-1" data-line-number="1">f &lt;-<span class="st"> </span><span class="cf">function</span>() { </a>
<a class="sourceLine" id="cb6-2" data-line-number="2">  sin</a>
<a class="sourceLine" id="cb6-3" data-line-number="3">}</a>
<a class="sourceLine" id="cb6-4" data-line-number="4"></a>
<a class="sourceLine" id="cb6-5" data-line-number="5"><span class="co"># pipe 5 to the value of f()</span></a>
<a class="sourceLine" id="cb6-6" data-line-number="6"><span class="co"># the .() says to evaluate f() before the</span></a>
<a class="sourceLine" id="cb6-7" data-line-number="7"><span class="co"># piping</span></a>
<a class="sourceLine" id="cb6-8" data-line-number="8"><span class="dv">5</span> <span class="op">%.&gt;%</span><span class="st"> </span>.(<span class="kw">f</span>())</a></code></pre></div>
<pre><code>## [1] -0.9589243</code></pre>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb8-1" data-line-number="1"><span class="co"># evaluate "f()"" with . = 5</span></a>
<a class="sourceLine" id="cb8-2" data-line-number="2"><span class="co"># not interesting as "f()"" is "dot free" </span></a>
<a class="sourceLine" id="cb8-3" data-line-number="3"><span class="dv">5</span> <span class="op">%.&gt;%</span><span class="st"> </span><span class="kw">f</span>()</a></code></pre></div>
<pre><code>## function (x)  .Primitive("sin")</code></pre>
<p>We can annotate any function as “eager eval” as follows.</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb10-1" data-line-number="1"><span class="kw"><a href="https://rdrr.io/r/base/attr.html">attr</a></span>(f, <span class="st">'dotpipe_eager_eval_function'</span>) &lt;-<span class="st"> </span><span class="ot">TRUE</span></a>
<a class="sourceLine" id="cb10-2" data-line-number="2"></a>
<a class="sourceLine" id="cb10-3" data-line-number="3"><span class="co"># now evalutates pipe on f() result.</span></a>
<a class="sourceLine" id="cb10-4" data-line-number="4"><span class="dv">5</span> <span class="op">%.&gt;%</span><span class="st"> </span><span class="kw">f</span>()</a></code></pre></div>
<pre><code>## [1] -0.9589243</code></pre>
</div>
<div id="conclusion" class="section level2">
<h2 class="hasAnchor">
<a href="#conclusion" class="anchor"></a>Conclusion</h2>
<p>When string-interpolation and quasi-quotation use the same notation we can teach them quickly as simple related concepts.</p>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">

        <div id="tocnav">
      <h2 class="hasAnchor">
<a href="#tocnav" class="anchor"></a>Contents</h2>
      <ul class="nav nav-pills nav-stacked">
<li><a href="#string-interpolation">String-interpolation</a></li>
      <li><a href="#quasi-quotation">Quasi-quotation</a></li>
      <li><a href="#conclusion">Conclusion</a></li>
      </ul>
</div>
      </div>

</div>



      <footer><div class="copyright">
  <p>Developed by John Mount, Nina Zumel.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.4.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>

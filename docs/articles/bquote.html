<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>bquote • wrapr</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="bquote">
<meta property="og:description" content="wrapr">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    

    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">wrapr</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">2.1.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/CornerCases.html">Corner Cases</a>
    </li>
    <li>
      <a href="../articles/DebugFnW.html">Debug Vignette</a>
    </li>
    <li>
      <a href="../articles/FrameTools.html">Frame Tools</a>
    </li>
    <li>
      <a href="../articles/Named_Arguments.html">Named Arguments</a>
    </li>
    <li>
      <a href="../articles/QuotingConcatinate.html">Quoting Concatinate</a>
    </li>
    <li>
      <a href="../articles/SubstitutionModes.html">Substitution Modes</a>
    </li>
    <li>
      <a href="../articles/bquote.html">bquote</a>
    </li>
    <li>
      <a href="../articles/dot_pipe.html">Dot Pipe</a>
    </li>
    <li>
      <a href="../articles/lambda.html">lambda Function Builder</a>
    </li>
    <li>
      <a href="../articles/let.html">Let</a>
    </li>
    <li>
      <a href="../articles/multi_assign.html">Multiple Assignment</a>
    </li>
    <li>
      <a href="../articles/named_map_builder.html">Named Map Builder</a>
    </li>
    <li>
      <a href="../articles/unpack_multiple_assignment.html">Multiple Assignment with unpack</a>
    </li>
    <li>
      <a href="../articles/wrapr_Eager.html">wrapr Eager Evaluation</a>
    </li>
    <li>
      <a href="../articles/wrapr_applicable.html">wrapr_applicable</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://win-vector.com" class="external-link">Sponsor: Win-Vector LLC</a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>bquote</h1>
                        <h4 data-toc-skip class="author">John Mount</h4>
            
            <h4 data-toc-skip class="date">2023-08-19</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/WinVector/wrapr/blob/HEAD/vignettes/bquote.Rmd" class="external-link"><code>vignettes/bquote.Rmd</code></a></small>
      <div class="hidden name"><code>bquote.Rmd</code></div>

    </div>

    
    
<p>It would be nice if <a href="https://www.r-project.org" class="external-link"><code>R</code></a> <a href="https://en.wikipedia.org/wiki/String_interpolation" class="external-link">string-interpolation</a>
and <a href="https://en.wikipedia.org/wiki/Grave_accent#Use_in_programming" class="external-link">quasi-quotation</a>
both used the same notation. They are related concepts. So some
commonality of notation would actually be clarifying, and help teach the
concepts. We will define both of the above terms, and demonstrate the
relation between the two concepts.</p>
<div class="section level2">
<h2 id="string-interpolation">String-interpolation<a class="anchor" aria-label="anchor" href="#string-interpolation"></a>
</h2>
<p><a href="https://en.wikipedia.org/wiki/String_interpolation" class="external-link">String-interpolation</a>
is the name for substituting value into a string. For example:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="st"><a href="https://github.com/WinVector/wrapr" class="external-link">"wrapr"</a></span><span class="op">)</span></span>
<span></span>
<span><span class="va">variable</span> <span class="op">&lt;-</span> <span class="st">"angle"</span></span>
<span></span>
<span><span class="fu"><a href="../reference/sinterp.html">sinterp</a></span><span class="op">(</span></span>
<span>  <span class="st">'variable name is .(variable)'</span></span>
<span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] "variable name is \"angle\""</span></span></code></pre>
<p>Notice the “<code>.(variable)</code>” portion was replaced with the
actual variable name “<code>angle</code>”. For string interpolation we
are intentionally using the “<code>.()</code>” notation that Thomas
Lumley’s picked in 2003 when he introduced quasi-quotation into
<code>R</code> (a different concept than string-interpolation, but the
topic of our next section).</p>
<p>String interpolation is a common need, and there are many <a href="https://www.r-project.org" class="external-link"><code>R</code></a> packages that supply
variations of such functionality:</p>
<ul>
<li><code><a href="https://rdrr.io/r/base/sprintf.html" class="external-link">base::sprintf</a></code></li>
<li><a href="https://CRAN.R-project.org/package=R.utils" class="external-link"><code>R.utils::gstring()</code></a></li>
<li><a href="https://CRAN.R-project.org/package=rprintf" class="external-link"><code>rprintf::rprintf()</code></a></li>
<li><a href="https://CRAN.R-project.org/package=stringr" class="external-link"><code>stringr::str_interp()</code></a></li>
<li><a href="https://CRAN.R-project.org/package=glue" class="external-link"><code>glue::glue()</code></a></li>
<li>
<a href="https://winvector.github.io/wrapr/reference/sinterp.html"><code>wrapr::sinterp()</code></a>.</li>
</ul>
</div>
<div class="section level2">
<h2 id="quasi-quotation">Quasi-quotation<a class="anchor" aria-label="anchor" href="#quasi-quotation"></a>
</h2>
<p>A related idea is <a href="https://en.wikipedia.org/wiki/Grave_accent#Use_in_programming" class="external-link">“quasi-quotation”</a>
which substitutes a value into a general expression. For example:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">angle</span> <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">10</span></span>
<span><span class="va">variable_name</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/name.html" class="external-link">as.name</a></span><span class="op">(</span><span class="st">"angle"</span><span class="op">)</span></span>
<span></span>
<span><span class="kw">if</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/ns-load.html" class="external-link">requireNamespace</a></span><span class="op">(</span><span class="st">"graphics"</span>, quietly <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu"><a href="../reference/evalb.html">evalb</a></span><span class="op">(</span></span>
<span>    </span>
<span>    <span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fu">.</span><span class="op">(</span><span class="op">-</span><span class="va">variable_name</span><span class="op">)</span>, </span>
<span>         y <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Trig.html" class="external-link">sin</a></span><span class="op">(</span><span class="fu">.</span><span class="op">(</span><span class="op">-</span><span class="va">variable_name</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span>    </span>
<span>  <span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
<p><img src="bquote_files/figure-html/unnamed-chunk-2-1.png" width="700"></p>
<p>Notice how in the above plot the actual variable name
“<code>angle</code>” was substituted into the
<code><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">graphics::plot()</a></code> arguments, allowing this name to appear on
the axis labels.</p>
<p>We can also use strings in place of names by using the
<code>.(-)</code> “strip quotes to convert strings to name
notation.”</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">angle</span> <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">10</span></span>
<span><span class="va">variable_string</span> <span class="op">&lt;-</span> <span class="st">"angle"</span></span>
<span></span>
<span><span class="kw">if</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/ns-load.html" class="external-link">requireNamespace</a></span><span class="op">(</span><span class="st">"graphics"</span>, quietly <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu"><a href="../reference/evalb.html">evalb</a></span><span class="op">(</span></span>
<span>    </span>
<span>    <span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fu">.</span><span class="op">(</span><span class="op">-</span><span class="va">variable_string</span><span class="op">)</span>, </span>
<span>         y <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Trig.html" class="external-link">sin</a></span><span class="op">(</span><span class="fu">.</span><span class="op">(</span><span class="op">-</span><span class="va">variable_string</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span>    </span>
<span>  <span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
<p><img src="bquote_files/figure-html/unnamed-chunk-3-1.png" width="700"></p>
<p><code><a href="../reference/evalb.html">evalb()</a></code> is a very simple function built on top of
<code><a href="https://rdrr.io/r/base/bquote.html" class="external-link">base::bquote()</a></code>.</p>
<p>All <code><a href="../reference/evalb.html">evalb()</a></code> does is: call <code><a href="https://rdrr.io/r/base/bquote.html" class="external-link">bquote()</a></code> as
intended, with the extension that <code>.(-x)</code> is shorthand for
<code>.(as.name(x))</code>.</p>
<p>And we see the un-executed code with the substitutions performed.</p>
<p>There are many <code>R</code> quasi-quotation systems including:</p>
<ul>
<li><code><a href="https://rdrr.io/r/base/bquote.html" class="external-link">base::bquote()</a></code></li>
<li><a href="https://CRAN.R-project.org/package=gtools" class="external-link"><code>gtools::strmacro()</code></a></li>
<li><a href="https://CRAN.R-project.org/package=lazyeval" class="external-link"><code>lazyeval</code></a></li>
<li><a href="https://winvector.github.io/wrapr/reference/let.html"><code>wrapr::let()</code></a></li>
<li><code><a href="https://rlang.r-lib.org/reference/new_quosure.html" class="external-link">rlang::as_quosure()</a></code></li>
<li><a href="https://CRAN.R-project.org/package=nseval" class="external-link"><code>nseval</code></a></li>
</ul>
<p>If you don’t want to wrap your <code><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot()</a></code> call in
<code><a href="../reference/evalb.html">evalb()</a></code> you can instead pre-adapt the function. Below we
create a new function <code>plotb()</code> that is intended as shorthand
for <code>eval(bquote(plot(…)))</code>.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">plotb</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/bquote_function.html">bquote_function</a></span><span class="op">(</span><span class="fu">graphics</span><span class="fu">::</span><span class="va"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">)</span></span>
<span></span>
<span><span class="kw">if</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/ns-load.html" class="external-link">requireNamespace</a></span><span class="op">(</span><span class="st">"graphics"</span>, quietly <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu">plotb</span><span class="op">(</span>x <span class="op">=</span> <span class="fu">.</span><span class="op">(</span><span class="op">-</span><span class="va">variable</span><span class="op">)</span>, </span>
<span>        y <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Trig.html" class="external-link">sin</a></span><span class="op">(</span><span class="fu">.</span><span class="op">(</span><span class="op">-</span><span class="va">variable</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
<p><img src="bquote_files/figure-html/unnamed-chunk-4-1.png" width="700"></p>
<p>The <code>wrapr</code> <a href="https://winvector.github.io/wrapr/reference/dot_arrow.html">dot
arrow pipe</a> also uses the <code>bquote</code>-style escape to specify
“extra execution”. For example.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">f</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="op">)</span> <span class="op">{</span> </span>
<span>  <span class="va">sin</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co"># pipe 5 to the value of f()</span></span>
<span><span class="co"># the .() says to evaluate f() before the</span></span>
<span><span class="co"># piping</span></span>
<span><span class="fl">5</span> <span class="op"><a href="../reference/dot_arrow.html">%.&gt;%</a></span> <span class="fu">.</span><span class="op">(</span><span class="fu">f</span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] -0.9589243</span></span></code></pre>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># evaluate "f()"" with . = 5</span></span>
<span><span class="co"># not interesting as "f()"" is "dot free" </span></span>
<span><span class="fl">5</span> <span class="op"><a href="../reference/dot_arrow.html">%.&gt;%</a></span> <span class="fu">f</span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## function (x)  .Primitive("sin")</span></span></code></pre>
<p>We can annotate any function as “eager eval” as follows.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/attr.html" class="external-link">attr</a></span><span class="op">(</span><span class="va">f</span>, <span class="st">'dotpipe_eager_eval_function'</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="cn">TRUE</span></span>
<span></span>
<span><span class="co"># now evalutates pipe on f() result.</span></span>
<span><span class="fl">5</span> <span class="op"><a href="../reference/dot_arrow.html">%.&gt;%</a></span> <span class="fu">f</span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] -0.9589243</span></span></code></pre>
</div>
<div class="section level2">
<h2 id="conclusion">Conclusion<a class="anchor" aria-label="anchor" href="#conclusion"></a>
</h2>
<p>When string-interpolation and quasi-quotation use the same notation
we can teach them quickly as simple related concepts.</p>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by John Mount, Nina Zumel.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

      </footer>
</div>

  


  

  </body>
</html>

<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Let • wrapr</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js" integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha256-916EbMg70RQy9LHiGkXzG8hSg9EdNy97GazNG/aiY1w=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha256-U5ZEeKfGNOja007MMD3YBI0A3OSZOQbeG6z2f2Y0hu8=" crossorigin="anonymous"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css" integrity="sha256-eZrrJcwDc/3uDhsdt61sL2oOBY362qM3lon1gyExkL0=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.4/clipboard.min.js" integrity="sha256-FiZwavyI2V6+EXO1U+xzLG3IKldpiTFf3153ea9zikQ=" crossorigin="anonymous"></script><!-- sticky kit --><script src="https://cdnjs.cloudflare.com/ajax/libs/sticky-kit/1.1.3/sticky-kit.min.js" integrity="sha256-c4Rlo1ZozqTPE2RLuvbusY3+SU1pQaJC0TjuhygMipw=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Let">
<meta property="og:description" content="">
<meta name="twitter:card" content="summary">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">wrapr</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">1.8.6</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fa fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/CornerCases.html">Corner Cases</a>
    </li>
    <li>
      <a href="../articles/DebugFnW.html">Debug Vignette</a>
    </li>
    <li>
      <a href="../articles/FrameTools.html">Frame Tools</a>
    </li>
    <li>
      <a href="../articles/Function_Objects.html">Function Objects</a>
    </li>
    <li>
      <a href="../articles/Named_Arguments.html">Named Arguments</a>
    </li>
    <li>
      <a href="../articles/QuotingConcatinate.html">Quoting Concatinate</a>
    </li>
    <li>
      <a href="../articles/SubstitutionModes.html">Substitution Modes</a>
    </li>
    <li>
      <a href="../articles/bquote.html">bquote</a>
    </li>
    <li>
      <a href="../articles/dot_pipe.html">Dot Pipe</a>
    </li>
    <li>
      <a href="../articles/lambda.html">lambda Function Builder</a>
    </li>
    <li>
      <a href="../articles/let.html">Let</a>
    </li>
    <li>
      <a href="../articles/named_map_builder.html">Named Map Builder</a>
    </li>
    <li>
      <a href="../articles/wrapr_applicable.html">wrapr_applicable</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="http://www.win-vector.com/">Sponsor: Win-Vector LLC</a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      
      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1>Let</h1>
                        <h4 class="author">Nina Zumel, John Mount</h4>
            
            <h4 class="date">2019-03-27</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/WinVector/wrapr/blob/master/vignettes/let.Rmd"><code>vignettes/let.Rmd</code></a></small>
      <div class="hidden name"><code>let.Rmd</code></div>

    </div>

    
    
<p>The vignette demonstrates the use of <code>let</code> to standardize calls to functions that use non-standard evaluation. For a more formal description please see <a href="https://github.com/WinVector/wrapr/blob/master/extras/wrapr_let.pdf">here</a>.</p>
<p>For the purposes of this discussion, <em>standard evaluation</em> of variables preserves referential transparency: that is, values and references to values behave the same.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">x =<span class="st"> </span><span class="dv">5</span>
<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/print">print</a></span>(<span class="dv">5</span> <span class="op">+</span><span class="st"> </span><span class="dv">1</span>)</code></pre></div>
<pre><code>## [1] 6</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/print">print</a></span>(x <span class="op">+</span><span class="st"> </span><span class="dv">1</span>)</code></pre></div>
<pre><code>## [1] 6</code></pre>
<p>Some functions in R use <em>non-standard evaluation</em> (NSE) of variables, in order to snoop variable names (for example, <code>plot</code>), or to delay or even avoid argument evaluation (for example <code><a href="https://www.rdocumentation.org/packages/base/topics/library">library(foobar)</a></code> versus <code><a href="https://www.rdocumentation.org/packages/base/topics/library">library("foobar")</a></code>).</p>
<p>In the case of <code>plot</code>, NSE lets <code>plot</code> use the variable names as the axis labels.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/Random">set.seed</a></span>(<span class="dv">1234</span>)
xvar =<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/stats/topics/Uniform">runif</a></span>(<span class="dv">100</span>) <span class="op">-</span><span class="st"> </span><span class="fl">0.5</span>
yvar =<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/stats/topics/Normal">dnorm</a></span>(xvar)

<span class="kw"><a href="https://www.rdocumentation.org/packages/graphics/topics/plot">plot</a></span>(xvar, yvar) </code></pre></div>
<p><img src="let_files/figure-html/unnamed-chunk-2-1.png" width="700"></p>
<p>In the case of <code>library</code>, non-standard evaluation saves typing a couple of quotes. The dollar sign notation for accessing data frame columns also uses non standard evaluation.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">d &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/data.frame">data.frame</a></span>(<span class="dt">x=</span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="dv">1</span>,<span class="ot">NA</span>))
d<span class="op">$</span>x</code></pre></div>
<pre><code>## [1]  1 NA</code></pre>
<p>Issues arise when you want to use functions that use non-standard evaluation – for brevity, I’ll call these <em>NSE expressions</em> – but you don’t know the name of the variable, as might happen when you are calling these expression from within another function. Generally in these situations, you are taking the name of the desired variable from a string. But how do you pass it to the NSE expression?</p>
<p>You need mapping power when, for example, trying to write parameterized <code>dplyr</code> transformations (or wrap <code>dplyr</code> pipelines in functions). See <a href="http://www.win-vector.com/blog/2016/12/using-replyrlet-to-parameterize-dplyr-expressions/">this blog post</a> for an example of using <code>let</code> to parameterize <code>dplyr</code> expressions, and <a href="http://www.win-vector.com/blog/2016/12/comparative-examples-using-replyrlet/">this post</a> for a discussion of alternative solutions (as of this writing and version 0.5.0 of <code>dplyr</code>).</p>
<p>For this discussion, we will demonstrate <code>let</code> to standardize calling <code>plot</code> with unknown variables. <code>let</code> takes two arguments:</p>
<ul>
<li>A list of assignments <em>symname=varname</em>, where <em>symname</em> is the name used in the NSE expression, and <em>varname</em> is the name (as a string) of the desired variable.</li>
<li>The NSE expression. Enclose a block of multiple expressions in brackets.</li>
</ul>
<p>Here’s the <code>plot</code> example again.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/library">library</a></span>(<span class="st">"wrapr"</span>)

xvariable =<span class="st"> "xvar"</span>
yvariable =<span class="st"> "yvar"</span>
<span class="kw"><a href="../reference/let.html">let</a></span>(
  <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="dt">XVARIABLE=</span>xvariable, <span class="dt">YVARIABLE=</span>yvariable),
  { <span class="co"># since we have the names as strings, we can create a title</span>
    title =<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/paste">paste</a></span>(yvariable, <span class="st">"vs"</span>, xvariable)
    <span class="kw"><a href="https://www.rdocumentation.org/packages/graphics/topics/plot">plot</a></span>(XVARIABLE, YVARIABLE, <span class="dt">main=</span>title)
  }
)</code></pre></div>
<p><img src="let_files/figure-html/unnamed-chunk-4-1.png" width="700"></p>
<p>In the above <code><a href="../reference/let.html">let()</a></code> block we are using the <code>alias</code>-convention that we specify substitution target names (in this case <code>XVARIABLE</code> and <code>YVARIABLE</code>) as upper-case analogues of the substitution name values (in this case <code>xvariable</code> and <code>yvariable</code>). This convention is very legible and makes it easy to both use value interfaces (as we did in the title <code><a href="https://www.rdocumentation.org/packages/base/topics/paste">paste()</a></code>) and name-capturing interfaces (<code><a href="https://www.rdocumentation.org/packages/graphics/topics/plot">plot()</a></code> itself).</p>
<div id="implementation-details" class="section level2">
<h2 class="hasAnchor">
<a href="#implementation-details" class="anchor"></a>Implementation details</h2>
<p>Roughly <code><a href="../reference/let.html">wrapr::let(A, B)</a></code> behaves like a syntactic sugar for <code><a href="https://www.rdocumentation.org/packages/base/topics/eval">eval(substitute(B, A))</a></code>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">a &lt;-<span class="st"> </span><span class="dv">1</span>
b &lt;-<span class="st"> </span><span class="dv">2</span>
<span class="kw"><a href="../reference/let.html">let</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="dt">z=</span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/substitute">quote</a></span>(a)), z<span class="op">+</span>b)</code></pre></div>
<pre><code>## [1] 3</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/eval">eval</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/substitute">substitute</a></span>(z<span class="op">+</span>b, <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="dt">z=</span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/substitute">quote</a></span>(a))))</code></pre></div>
<pre><code>## [1] 3</code></pre>
<p>However, <code><a href="../reference/let.html">wrapr::let()</a></code> is actually implemented in terms of a de-parse and safe language token substitution.</p>
<p><code><a href="../reference/let.html">wrapr::let()</a></code> was inspired by <code><a href="https://www.rdocumentation.org/packages/gtools/topics/defmacro">gtools::strmacro()</a></code> and <code><a href="https://www.rdocumentation.org/packages/base/topics/bquote">base::bquote()</a></code>, please see <a href="https://github.com/WinVector/wrapr/blob/master/extras/bquote.md">here</a> for some notes on macro methods in <code>R</code>.</p>
</div>
<div id="more" class="section level2">
<h2 class="hasAnchor">
<a href="#more" class="anchor"></a>More</h2>
<p>For more discussion please see:</p>
<ul>
<li>
<a href="https://youtu.be/iKLGxzzm9Hk?list=PLAKBwakacHbQp_Z66asDnjn-0qttTO-o9">our video on non-standard evaluation and <code>let</code></a>.</li>
<li>
<a href="http://adv-r.had.co.nz/Computing-on-the-language.html">Advanced R NSE</a>.</li>
<li>
<a href="http://developer.r-project.org/nonstandard-eval.pdf">Standard nonstandard evaluation rules</a>.</li>
<li>
<a href="https://github.com/WinVector/wrapr/blob/master/extras/wrapr_let.pdf">technical article on let</a>.</li>
</ul>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
        <div id="tocnav">
      <h2 class="hasAnchor">
<a href="#tocnav" class="anchor"></a>Contents</h2>
      <ul class="nav nav-pills nav-stacked">
<li><a href="#implementation-details">Implementation details</a></li>
      <li><a href="#more">More</a></li>
      </ul>
</div>
      </div>

</div>


      <footer><div class="copyright">
  <p>Developed by John Mount, Nina Zumel.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.3.0.</p>
</div>
      </footer>
</div>

  

  </body>
</html>
